<html>
  <head>
    <title>Kohr</title>
    <link rel="icon" href="https://cdn.discordapp.com/attachments/682997526676373521/712225425656643594/favicon.ico" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&display=swap&subset=latin-ext" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/css/utility">
    <link rel="stylesheet" type="text/css" href="/css/login">
    <link rel="stylesheet" type="text/css" href="/css/game">
    <link rel="stylesheet" type="text/css" href="/css/lobby">
    <script type="text/javascript" src="/js/landscape"></script>
  </head>
  <body id="body">

    <div id="cache-frame" hidden>
      <img id="cache-blue_pawn" width="500" height="500" src="/piece/blue_pawn">
      <img id="cache-blue_enchanter" width="500" height="500" src="/piece/blue_enchanter">
      <img id="cache-blue_rook" width="500" height="500" src="/piece/blue_rook">
      <img id="cache-blue_knight" width="500" height="500" src="/piece/blue_knight">
      <img id="cache-blue_bishop" width="500" height="500" src="/piece/blue_bishop">
      <img id="cache-blue_queen" width="500" height="500" src="/piece/blue_queen">
      <img id="cache-red_pawn" width="500" height="500" src="/piece/red_pawn">
      <img id="cache-red_enchanter" width="500" height="500" src="/piece/red_enchanter">
      <img id="cache-red_rook" width="500" height="500" src="/piece/red_rook">
      <img id="cache-red_knight" width="500" height="500" src="/piece/red_knight">
      <img id="cache-red_bishop" width="500" height="500" src="/piece/red_bishop">
      <img id="cache-red_queen" width="500" height="500" src="/piece/red_queen">
      <img id="cache-blue_extractor" width="500" height="500" src="/building/blue_extractor">
      <img id="cache-blue_lightarmory" width="500" height="500" src="/building/blue_light">
      <img id="cache-blue_heavyarmory" width="500" height="500" src="/building/blue_heavy">
      <img id="cache-blue_battery" width="500" height="500" src="/building/blue_battery">
      <img id="cache-blue_workshop" width="500" height="500" src="/building/blue_workshop">
      <img id="cache-blue_wall" width="500" height="500" src="/building/blue_wall">
      <img id="cache-red_extractor" width="500" height="500" src="/building/red_extractor">
      <img id="cache-red_lightarmory" width="500" height="500" src="/building/red_light">
      <img id="cache-red_heavyarmory" width="500" height="500" src="/building/red_heavy">
      <!--img id="cache-red_battery" width="500" height="500" src="/building/red_battery">
      <img id="cache-red_workshop" width="500" height="500" src="/building/red_workshop"-->
      <img id="cache-red_wall" width="500" height="500" src="/building/red_wall">
      <img id="cache-blue_core" width="500" height="500" src="/building/blue_core">
      <img id="cache-red_core" width="500" height="500" src="/building/red_core">
    </div>

    <div id="disconnected-frame">
      <h1 id="disconnected-title" class="noSelect">._.</h1>
      <p id="load-font" class="noSelect">loading</p>
    </div>

    <div id="landscape-frame" hidden>
      <h1 id="landscape-title" class="noSelect">Tourne ton écran zebi !</h1>
    </div>

    <div id="login-frame" hidden>
      <h1 id="login-title" class="noSelect">Bienvenue sur Kohr !</h1>
      <form id="login-background">
        <label id="login-label" class="noSelect">Pseudo :<input id="login-pseudo-input" autocomplete="off" placeholder="Jean-Kévin"/></label>
        <input id="login-submit-fullscreen" class="login-submit" value="C'est parti !" type="submit"/>
        <input id="login-submit-normal" class="login-submit" value="Jouer sans plein écran" type="submit"/>
      </form>
    </div>
    
    <div id="lobby-frame" hidden>
      <h1 id="lobby-title" class="noSelect">Partie : </h1>
      <p id="lobby-gamemode" class="noSelect">Mode : </p>
      <p id="lobby-player-list-label" class="noSelect">Joueurs</p>
      <ul id="lobby-action-list"></ul>
      <ul id="lobby-player-list"></ul>
    </div>

    <div id="game-frame" hidden>
      <div id="game-board">
        <div id="game-base-side">
          <button class="game-buttons game-skip">Finir le tour</button>
          <button class="game-buttons game-switch" id="game-base-change-board">Voir le Kohr</button>
          <canvas class="game-canvas" id="game-base-canvas"></canvas>
          <div class="game-energybar" id="game-base-energybar">
            <img class="game-energybar-under" src="/img/energybar_under"/>
            <div class="game-energybar-energy"></div>
            <img class="game-energybar-above" src="/img/energybar_above"/>
            <div class="game-energy-prod">
              <img class="game-energy-prod-icon" src="/icon/energy_prod"/>
              <p class="game-energy-prod-count">5 / tour</p>
            </div>
            <div class="game-energy">
              <img class="game-energy-icon" src="/icon/energy"/>
              <p class="game-energy-count">0 / 16</p>
            </div>
          </div>
          <div class="game-ressources">
            <div class="game-copper">
              <img class="game-ressource-icon" src="/icon/copper"/>
              <p class="game-copper-count game-ressource-count">x0000</p>
            </div>
            <div class="game-titanium">
              <img class="game-ressource-icon" src="/icon/titanium"/>
              <p class="game-titanium-count game-ressource-count">x0000</p>
            </div>
            <div class="game-gold">
              <img class="game-ressource-icon" src="/icon/gold"/>
              <p class="game-gold-count game-ressource-count">x0000</p>
            </div>
            <div class="game-ruby">
              <img class="game-ressource-icon" src="/icon/ruby"/>
              <p class="game-ruby-count game-ressource-count">x0000</p>
            </div>
          </div>
          <div class="game-actions">
            <p class="game-action-1">Ce n'est pas à votre tour de jouer !</p>
            <p class="game-action-2">Entité ennemie !</p>
            <p class="game-action-3">La pièce n'a pas fini de se construire !</p>
            <ul class="game-action-4">
              <button class="game-buttons game-precreate-button game-swicth-Queen" id="game-base-precreatepiece-Queen"><img class="game-precreate-img" src="/piece/blue_queen"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Rook" id="game-base-precreatepiece-Rook"><img class="game-precreate-img" src="/piece/blue_rook"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Enchanter" id="game-base-precreatepiece-Enchanter"><img class="game-precreate-img" src="/piece/blue_enchanter"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Knight" id="game-base-precreatepiece-Knight"><img class="game-precreate-img" src="/piece/blue_knight"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Bishop" id="game-base-precreatepiece-Bishop"><img class="game-precreate-img" src="/piece/blue_bishop"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Pawn" id="game-base-precreatepiece-Pawn"><img class="game-precreate-img" src="/piece/blue_pawn"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Extractor" id="game-base-precreatebuilding-Extractor"><img class="game-precreate-img" src="/building/blue_extractor"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Wall" id="game-base-precreatebuilding-Wall"><img class="game-precreate-img" src="/building/blue_wall"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Battery" id="game-base-precreatebuilding-Battery"><img class="game-precreate-img" src="/building/blue_battery"/></button>
              <button class="game-buttons game-precreate-button game-swicth-Workshop" id="game-base-precreatebuilding-Workshop"><img class="game-precreate-img" src="/building/blue_workshop"/></button>
              <button class="game-buttons game-precreate-button game-swicth-LightArmory" id="game-base-precreatebuilding-LightArmory"><img class="game-precreate-img" src="/building/blue_light"/></button>
              <button class="game-buttons game-precreate-button game-swicth-HeavyArmory" id="game-base-precreatebuilding-HeavyArmory"><img class="game-precreate-img" src="/building/blue_heavy"/></button>
            </ul>
            <ul class="game-action-5">
              <button class="game-button game-move game-switch-13"></button>
              <button class="game-button game-attack1 game-switch-14"></button>
              <button class="game-button game-attack2 game-switch-15"></button>
            </ul>
            <ul class="game-action-6">
              <button class="game-button game-collect"></button>
              <div class="game-change-prod">
                <button class="game-button game-change-prod-1"></button>
                <button class="game-button game-change-prod-1"></button>
                <button class="game-button game-change-prod-1"></button>
              </div>
              <button class="game-button game-upgrade"></button>
              <button class="game-button game-destroy"></button>
              <p class="game-no-interraction">Aucune action possible !</p>
            </ul>
          </div>
          <div class="game-timer-background">
            <p class="game-timer-text">30s</p>
          </div>
        </div>
        <div id="game-kohr-side">
          <button class="game-buttons game-skip">Finir le tour</button>
          <button class="game-buttons game-switch" id="game-kohr-change-board">Voir la Base</button>
          <canvas class="game-canvas" id="game-kohr-canvas"></canvas>
          <div class="game-energybar" id="game-kohr-energybar">
            <img class="game-energybar-under" src="/img/energybar_under"/>
            <div class="game-energybar-energy"></div>
            <img class="game-energybar-above" src="/img/energybar_above"/>
            <div class="game-energy-prod">
              <img class="game-energy-prod-icon" src="/icon/energy_prod"/>
              <p class="game-energy-prod-count">5 / tour</p>
            </div>
            <div class="game-energy">
              <img class="game-energy-icon" src="/icon/energy"/>
              <p class="game-energy-count">0 / 16</p>
            </div>
          </div>
          <div class="game-ressources">
            <div class="game-copper">
              <img class="game-ressource-icon" src="/icon/copper"/>
              <p class="game-copper-count game-ressource-count">x0000</p>
            </div>
            <div class="game-titanium">
              <img class="game-ressource-icon" src="/icon/titanium"/>
              <p class="game-titanium-count game-ressource-count">x0000</p>
            </div>
            <div class="game-gold">
              <img class="game-ressource-icon" src="/icon/gold"/>
              <p class="game-gold-count game-ressource-count">x0000</p>
            </div>
            <div class="game-ruby">
              <img class="game-ressource-icon" src="/icon/ruby"/>
              <p class="game-ruby-count game-ressource-count">x0000</p>
            </div>
          </div>
          <div class="game-timer-background">
            <p class="game-timer-text">30s</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function() {
        var socket = io();
        pseudo = "#-1";
        gameTimerIntervalId = undefined;
        selected = {unselect:true,x:1,y:1,atMiddle:true,switch:0}
        actionOrigin = {unselect:true,x:1,y:1,atMiddle:true}
        game = {}
        canPlay = false
        var imageOffsets = {}
        imageOffsets["Pawn"] = [0,25]
        imageOffsets["Enchanter"] = [0,25]
        imageOffsets["Knight"] = [0,25]
        imageOffsets["Rook"] = [0,25]
        imageOffsets["Bishop"] = [0,25]
        imageOffsets["Queen"] = [0,25]
        imageOffsets["Core"] = [0,25]
        imageOffsets["Extractor"] = [0,25]
        imageOffsets["LightArmory"] = [0,25]
        imageOffsets["HeavyArmory"] = [0,25]
        imageOffsets["Battery"] = [0,25]
        imageOffsets["Workshop"] = [0,25]
        imageOffsets["Wall"] = [0,25]
        var imageScales = {}
        imageScales["Pawn"] = 2
        imageScales["Enchanter"] = 2
        imageScales["Knight"] = 2
        imageScales["Rook"] = 2
        imageScales["Bishop"] = 2
        imageScales["Queen"] = 2
        imageScales["Core"] = 2
        imageScales["Extractor"] = 2
        imageScales["LightArmory"] = 2
        imageScales["HeavyArmory"] = 2
        imageScales["Battery"] = 2
        imageScales["Workshop"] = 2
        imageScales["Wall"] = 2

        
        $('#login-background').on('submit', function(e){
          e.preventDefault();
        });

        $('.login-submit').on('click', function(){
          var enteredPseudo = $("#login-pseudo-input").val().trim()
          setLandscape(false)
          if(pseudo == "#-1"){
            document.location.reload(false);
          }
          if(/^[a-z0-9àäâéèëêïîôûùç\-_]*/i.test(enteredPseudo)){
            socket.emit("joinSession",{pseudo : enteredPseudo, tempName : pseudo});
            pseudo = enteredPseudo
            if(this.id == "login-submit-fullscreen"){
              var body = document.getElementById("body")
              if (body.requestFullscreen) {
                body.requestFullscreen();
              } else if (body.webkitRequestFullscreen) { /* Safari */
                body.webkitRequestFullscreen();
              } else if (body.msRequestFullscreen) { /* IE11 */
                body.msRequestFullscreen();
              }
            }
          }
          else{
            alert("Pseudo invalid !")
          }
        })

        $(".game-buttons").on("click",function(){
          var buttonId = $(this).attr("id")
          var buttonBoard = buttonId.slice(5,9) //kohr or base
          var buttonType = buttonId.slice(10)
          if(buttonType == "change-board"){
            if(buttonBoard == 'base'){
              $("#game-board").css("left", "-100%");
            }else{
              $("#game-board").css("left", "0%");
            }
          }else if(buttonType.startsWith("precreatepiece")){
            var cuts = buttonId.split("-");
            selected.switch = cuts[cuts.length - 1]
            showGame(game,pseudo,selected,canPlay)
          }
        })

        $(".game-canvas").on("click",function(e){
          let tempMe = game.players.find(player => player.pseudo == pseudo)
          if(tempMe == undefined){
            console.log("oula")
            return
          }
          var play = (tempMe.team == game.gameInfo.teamPlaying)
          var parentOffset = $(this).offset(); 
          var clickX = e.pageX - parentOffset.left;
          var clickY = e.pageY - parentOffset.top;
          var maxHeight = parseInt($("#game-frame").css("height"))
          var maxWidth = parseInt($("#game-frame").css("width"))
          var canvasHeight = parseInt($(this).css("height"))
          var canvasWidth = parseInt($(this).css("width"))
          var gridHeight = Math.min(maxHeight, maxWidth/2)
          if($(this).attr("id") == "game-base-canvas"){
            grid = 0.5*game.gameInfo.maxPlayers + 3
            selected.atMiddle = false
          }else{
            grid = game.gameInfo.maxPlayers + 5
            selected.atMiddle = true
          }
          var m = gridHeight / (1.3*grid)
          var clickX = clickX - 2*m
          var clickY = clickY - m
          var relX = clickX / (canvasWidth - 4*m)
          var relY = clickY / (canvasHeight - 2*m)
          var isoX = relY + relX - 0.5
          var isoY = 1 - (relY - relX + 0.5)
          var coordX = Math.floor(isoX*grid+1)
          var coordY = Math.floor(isoY*grid+1)
          if(tempMe.team == 1){
            coordX = -1*coordX + grid + 1
            coordY = -1*coordY + grid + 1
          }
          if(coordX > 0 && coordX <= grid && coordY > 0 && coordY <= grid){
            selected.unselect = false
            selected.x = coordX
            selected.y = coordY
          }else{
            selected.unselect = true
          }
          
          showGame(game,pseudo,selected,play)
        });

        function countBuildings(game,type,team){
          var counter = 0
          game.buildings.forEach(function(building){
            if(building.type == type && building.team == team){
              counter = counter + 1
            }
          })
          return counter
        }

        function setGameTimer(time,canPlay,maxTime){
          if(time > maxTime){
            time = maxTime;
          }
          $(".game-timer-text").text((Math.ceil(maxTime)-Math.round(time)) + "s")
          var transparent = "rgb(30,30,40)"
          var red = "rgb(80,60,80)"
          var green = "rgb(60,80,80)"
          if(canPlay){
            var deg = time * (180/maxTime)
            if(time < maxTime/2){
              var background = transparent + " 0deg 270deg, " + green + " 270deg " + (270+deg) + "deg, " + transparent + " " + (270+deg) + "deg" 
            }else{
              var background = green + " " + (-90+deg) + "deg, " + transparent +" "+ (-90+deg) + "deg 270deg, " + green + " 270deg"
            }
          }else{
            var deg = (maxTime-time) * (180/maxTime)
            if(time < maxTime/2){
              var background = transparent +" "+ (-90+deg) + "deg, " + red +" "+ (-90+deg) + "deg 90deg, " + transparent + " 270deg"
            }else{
              var background = red + " 90deg, " + transparent + " 90deg " + (270+deg) + "deg, " + red + " " + (270+deg) + "deg" 
            }
          }
          $(".game-timer-background").css("background","conic-gradient(" + background + ")")

        }

        function countBuildings(game,buildingName,team,onlyAtMiddle){
          var onlyAtMiddle = onlyAtMiddle || false
          var count = 0
          game.buildings.forEach(function(building){
            if(building.type == buildingName && building.team == team && !(onlyAtMiddle && !building.atMiddle)){
              count = count + 1
            }
          },this)
          return count
        }

        function countPieces(game,pieceName,team){
          var count = 0
          game.pieces.forEach(function(piece){
            if(piece.type == pieceName && piece.team == team){
              count = count + 1
            }
          },this)
          return count
        }

        function getCapacity(game,type,team){
          var armoryName = type.toLowerCase() + "Armory"
          var armoryAtMiddleCount = countBuildings(game,armoryName, team, true)
          var allArmoryCount = countBuildings(game,armoryName, team)
          var armoryAtBaseCount = allArmoryCount - armoryAtMiddleCount
          if(type="LIGHT"){
            armoryAtBaseCount += 1
          }
          var capacity = armoryAtMiddleCount*2 + armoryAtBaseCount
          return capacity
        }

        function getWallNeighbors(entities,originX,originY,team,wallTeam){
          if(team == 0){
            var topLeft = entities.find(entity => entity.type == "Wall" && entity.x == originX-1 && entity.y == originY && entity.atMiddle && entity.team == wallTeam)
            var topRight = entities.find(entity => entity.type == "Wall" && entity.x == originX && entity.y == originY+1 && entity.atMiddle && entity.team == wallTeam)
            var bottomLeft = entities.find(entity => entity.type == "Wall" && entity.x == originX && entity.y == originY-1 && entity.atMiddle && entity.team == wallTeam)
            var bottomRight = entities.find(entity => entity.type == "Wall" && entity.x == originX+1 && entity.y == originY && entity.atMiddle && entity.team == wallTeam)
          }else{
            var topLeft = entities.find(entity => entity.type == "Wall" && entity.x == originX+1 && entity.y == originY && entity.atMiddle && entity.team == wallTeam)
            var topRight = entities.find(entity => entity.type == "Wall" && entity.x == originX && entity.y == originY-1 && entity.atMiddle && entity.team == wallTeam)
            var bottomLeft = entities.find(entity => entity.type == "Wall" && entity.x == originX && entity.y == originY+1 && entity.atMiddle && entity.team == wallTeam)
            var bottomRight = entities.find(entity => entity.type == "Wall" && entity.x == originX-1 && entity.y == originY && entity.atMiddle && entity.team == wallTeam)
          }
          topLeft = topLeft || false
          topRight = topRight || false
          bottomLeft = bottomLeft || false
          bottomRight = bottomRight || false
          return [topLeft,topRight,bottomLeft,bottomRight]
        }

        function orderEntitiesAlgo(a,b){
          var aMiddle = a.atMiddle || true;
          var bMiddle = b.atMiddle || true; //if atMiddle is undefined it's a piece, so it's True
          if(aMiddle && !bMiddle){
            return -1
          }else if(!aMiddle && bMiddle){
            return 1
          }else{
            if(a.y - a.x > b.y - b.x){
              return -1
            }else if(b.y - b.x > a.y - a.x){
              return 1
            }
          }
          return 0
        }

        function orderEntitiesAlgoInverted(a,b){
          var aMiddle = a.atMiddle || true;
          var bMiddle = b.atMiddle || true; //if atMiddle is undefined it's a piece, so it's True
          if(aMiddle && !bMiddle){
            return -1
          }else if(!aMiddle && bMiddle){
            return 1
          }else{
            if(a.y - a.x < b.y - b.x){
              return -1
            }else if(b.y - b.x < a.y - a.x){
              return 1
            }
          }
          return 0
        }

        function orderEntities(gameToOrder,showTeam){
          var allEntities = gameToOrder.pieces.concat(gameToOrder.buildings)
          if(showTeam == 0){
            allEntities.sort(orderEntitiesAlgo)
          }else{
            allEntities.sort(orderEntitiesAlgoInverted)
          }
          return allEntities
        }

        function drawPoly(ctx,gX,gY,points,polyHeight,fillColor,border){
          ctx.beginPath()
          ctx.fillStyle = fillColor
          ctx.lineCap = "round"
          ctx.strokeStyle = border[0]
          ctx.lineWidth = border[1]
          ctx.shadowColor = fillColor
          ctx.shadowBlur = 30
          points.forEach(function(point){
            ctx.lineTo(point[0]+gX,point[1]+gY-polyHeight)
          })
          ctx.closePath()
          ctx.fill()
          ctx.stroke()
          ctx.shadowBlur = 0
        }

        function drawParaS(ctx,gX,gY,points,paraHeight,fillColor,border){
          ctx.beginPath()
          ctx.fillStyle = fillColor
          ctx.lineCap = "round"
          ctx.strokeStyle = border[0]
          ctx.lineWidth = border[1]
          ctx.moveTo(points[0][0]+gX,points[0][1]+gY)
          ctx.lineTo(points[1][0]+gX,points[1][1]+gY)
          ctx.lineTo(points[1][0]+gX,points[1][1]+gY-paraHeight)
          ctx.lineTo(points[0][0]+gX,points[0][1]+gY-paraHeight)
          ctx.closePath()
          ctx.fill()
          ctx.beginPath()
          ctx.moveTo(points[0][0]+gX,points[0][1]+gY)
          ctx.lineTo(points[1][0]+gX,points[1][1]+gY)
          ctx.moveTo(points[1][0]+gX,points[1][1]+gY-paraHeight)
          ctx.lineTo(points[0][0]+gX,points[0][1]+gY-paraHeight)
          ctx.stroke()
          ctx.setLineDash([0, paraHeight]);
          ctx.beginPath()
          ctx.moveTo(points[0][0]+gX,points[0][1]+gY)
          ctx.lineTo(points[0][0]+gX,points[0][1]+gY-paraHeight)
          ctx.moveTo(points[1][0]+gX,points[1][1]+gY)
          ctx.lineTo(points[1][0]+gX,points[1][1]+gY-paraHeight)
          ctx.stroke()
          ctx.setLineDash([]);
        }

        function showGame(givenGame,userPseudo,userSelected,canPlay){
          //SHOW THE GAME
          $("#lobby-frame").attr("hidden",true);
          $("#game-frame").attr("hidden",false);

          //SET DYNAMIC CSS PROPERTIES AT START
          $(".game-energybar").css("height",$(".game-energybar-under").first().css("height"))
          $(".game-ressources").css("height",2*parseInt($(".game-energybar-under").first().css("height")) + "px")
          $(".game-ressource-count").css("left",$(".game-ressources").first().css("height"))
          $(".game-ressource-count").css("font-size",(2/5)*parseInt($(".game-ressources").first().css("height")) + "px")
          $(".game-energy-prod-count").css("left",$(".game-energybar-under").first().css("height"))
          $(".game-energy-count").css("right",$(".game-energybar-under").first().css("height"))
          $(".game-energy-prod-count").css("font-size",(3/5)*parseInt($(".game-energybar-under").first().css("height")) + "px")
          $(".game-energy-count").css("font-size",(3/5)*parseInt($(".game-energybar-under").first().css("height")) + "px")
          $(".game-timer-background").css("width",$(".game-timer-background").css("height"))
          $(".game-timer-text").css("font-size",(1/3)*parseInt($(".game-timer-text").css("width")) + "px")
          $(".game-skip").css("top","calc(6% + "+(2*parseInt($(".game-energybar-under").first().css("height"))) + "px)")
          $(".game-switch").css("top","calc(6% + "+(2*parseInt($(".game-energybar-under").first().css("height"))) + "px)")
          $(".game-action-4").css("width", (265/320)*$(".game-actions").width() + "px")
          $(".game-precreate-button").css("width", (60/320)*$(".game-actions").width() + "px")
          $(".game-precreate-button").css("height", (60/320)*$(".game-actions").width() + "px")

          //GET PLAYER TEAM
          var tempMe = givenGame.players.find(player => player.pseudo == userPseudo)
          if(tempMe == undefined){
            console.log("oula")
            return givenGame
          }
          var userTeam = tempMe.team

          //SET OF TIMER
          if(givenGame.newTurn != 0){
            var maxTime = givenGame.newTurn
            givenGame.newTurn = 0;
            var timerZero = Date.now()
            clearInterval(gameTimerIntervalId)
            gameTimerIntervalId = setInterval(function(){
              setGameTimer((Date.now() - timerZero)/1000,canPlay,maxTime)
            }, 50);
          }

          //SET COUNTS
          $(".game-copper-count").text("x" + givenGame.stats[userTeam][1])
          $(".game-titanium-count").text("x" + givenGame.stats[userTeam][2])
          $(".game-gold-count").text("x" + givenGame.stats[userTeam][3])
          $(".game-ruby-count").text("x" + givenGame.stats[userTeam][4])
          $(".game-energy-count").text("x" + givenGame.stats[userTeam][4])

          //SET ENERGY BAR
          var allWidth = parseInt($(".game-energybar-under").css("width"))
          var roundSize = parseInt($(".game-energybar-energy").css("height"))/2 + "px"
          var prod = 5 + countBuildings(givenGame,"Workshop",userTeam);
          var maxCapacity = 10 + 2*countBuildings(givenGame,"Battery",userTeam);
          var energy = givenGame.stats[userTeam][0]
          $(".game-energy-prod-count").text(prod + " / tour")
          $(".game-energy-count").text(energy + " / " + maxCapacity)
          if(energy == 0){
            $(".game-energybar-energy").css("border-radius","0px")
          }else if(energy < maxCapacity){
            $(".game-energybar-energy").css("border-radius",roundSize + " 0px 0px " + roundSize)
          }else{
            $(".game-energybar-energy").css("border-radius",roundSize)
          }
          var energyWidth = (energy * allWidth) / maxCapacity
          $(".game-energybar-energy").css("width",energyWidth + "px")

          //GET CANVAS AND DEFINE LIMITING DIMENSION
          var baseCanvas = document.getElementById("game-base-canvas")
          var kohrCanvas = document.getElementById("game-kohr-canvas")
          var maxHeight = parseInt($("#game-frame").css("height"))
          var maxWidth = parseInt($("#game-frame").css("width"))
          alert(maxHeight)
          alert(maxWidth)
          alert(screen.height)
          alert(screen.width)
          var gridHeight = Math.min(maxHeight, maxWidth/2)
          var gridWidth = gridHeight * 2
          baseCanvas.height = gridHeight
          baseCanvas.width = gridWidth
          kohrCanvas.height = gridHeight
          kohrCanvas.width = gridWidth

          //CALCULATE GRID, M AND CELL FOR BASE AND KOHR
          var baseGrid = 0.5*givenGame.gameInfo.maxPlayers + 3
          var baseM = gridHeight / (1.3*baseGrid)
          var kohrGrid = givenGame.gameInfo.maxPlayers + 5
          var kohrM = gridHeight / (1.3*kohrGrid)
          var baseHeightCell = ((gridHeight - (2*baseM)) / 2) / baseGrid
          var baseWidthCell = ((gridWidth - (4*baseM)) / 2) / baseGrid
          var kohrHeightCell = ((gridHeight - (2*kohrM)) / 2) / kohrGrid
          var kohrWidthCell = ((gridWidth - (4*kohrM)) / 2) / kohrGrid
          var baseCtx = baseCanvas.getContext("2d");
          var kohrCtx = kohrCanvas.getContext("2d");

          //DRAW SELECTED SQUARE
          if(!userSelected.unselect){
            if(userSelected.atMiddle){
              if(tempMe.team == 1){
                var x = -1*userSelected.x + kohrGrid + 1
                var y = -1*userSelected.y + kohrGrid + 1
              }else{
                var x = userSelected.x
                var y = userSelected.y
              }
              kohrCtx.fillStyle = '#3c5050';
              kohrCtx.beginPath();
              let leftPointX = (2*kohrM) + ((x-1)*kohrWidthCell) + ((y-1)*kohrWidthCell)
              let leftPointY = (gridHeight/2) + ((x-1)*kohrHeightCell) - ((y-1)*kohrHeightCell)
              kohrCtx.moveTo(leftPointX,leftPointY);
              kohrCtx.lineTo(leftPointX+kohrWidthCell,leftPointY-kohrHeightCell);
              kohrCtx.lineTo(leftPointX+2*kohrWidthCell,leftPointY);
              kohrCtx.lineTo(leftPointX+kohrWidthCell,leftPointY+kohrHeightCell);
              kohrCtx.closePath();
              kohrCtx.fill();
            }else{
              if(tempMe.team == 1){
                var x = -1*userSelected.x + baseGrid + 1
                var y = -1*userSelected.y + baseGrid + 1
              }else{
                var x = userSelected.x
                var y = userSelected.y
              }
              baseCtx.fillStyle = '#3c5050';
              baseCtx.beginPath();
              let leftPointX = (2*baseM) + ((x-1)*baseWidthCell) + ((y-1)*baseWidthCell)
              let leftPointY = (gridHeight/2) + ((x-1)*baseHeightCell) - ((y-1)*baseHeightCell)
              baseCtx.moveTo(leftPointX,leftPointY);
              baseCtx.lineTo(leftPointX+baseWidthCell,leftPointY-baseHeightCell);
              baseCtx.lineTo(leftPointX+2*baseWidthCell,leftPointY);
              baseCtx.lineTo(leftPointX+baseWidthCell,leftPointY+baseHeightCell);
              baseCtx.closePath();
              baseCtx.fill();
            }
          }

          //DRAW BASE GRID
          baseCtx.strokeStyle = "#6e6e91"
          baseCtx.lineCap = "round";
          baseCtx.lineWidth = 4;
          var xS = (gridWidth - (4*baseM)) / 2
          var yS = 0
          var xE = (gridWidth - (4*baseM))
          var yE = (gridHeight - (2*baseM)) / 2
          for(let i = 0; i <= baseGrid; i++){
            baseCtx.moveTo(xS+2*baseM,yS+baseM)
            baseCtx.lineTo(xE+2*baseM,yE+baseM)
            baseCtx.stroke()
            xS -= baseWidthCell
            yS += baseHeightCell
            xE -= baseWidthCell
            yE += baseHeightCell
          }
          var xS = 0
          var yS = (gridHeight - (2*baseM)) / 2
          var xE = (gridWidth - (4*baseM)) / 2
          var yE = 0
          for(let i = 0; i <= baseGrid; i++){
            baseCtx.moveTo(xS+2*baseM,yS+baseM)
            baseCtx.lineTo(xE+2*baseM,yE+baseM)
            baseCtx.stroke()
            xS += baseWidthCell
            yS += baseHeightCell
            xE += baseWidthCell
            yE += baseHeightCell
          }

          //DRAW KOHR GRID
          kohrCtx.strokeStyle = "#6e6e91"
          kohrCtx.lineCap = "round";
          kohrCtx.lineWidth = 4;
          var xS = (gridWidth - (4*kohrM)) / 2
          var yS = 0
          var xE = (gridWidth - (4*kohrM))
          var yE = (gridHeight - (2*kohrM)) / 2
          for(let i = 0; i <= kohrGrid; i++){
            kohrCtx.moveTo(xS+2*kohrM,yS+kohrM)
            kohrCtx.lineTo(xE+2*kohrM,yE+kohrM)
            kohrCtx.stroke()
            xS -= kohrWidthCell
            yS += kohrHeightCell
            xE -= kohrWidthCell
            yE += kohrHeightCell
          }
          var xS = 0
          var yS = (gridHeight - (2*kohrM)) / 2
          var xE = (gridWidth - (4*kohrM)) / 2
          var yE = 0
          for(let i = 0; i <= kohrGrid; i++){
            kohrCtx.moveTo(xS+2*kohrM,yS+kohrM)
            kohrCtx.lineTo(xE+2*kohrM,yE+kohrM)
            kohrCtx.stroke()
            xS += kohrWidthCell
            yS += kohrHeightCell
            xE += kohrWidthCell
            yE += kohrHeightCell
          }

          //DRAW ENTITIES
          var entitiesToDraw = orderEntities(givenGame,userTeam)
          kohrCtx.shadowColor = "black";
          baseCtx.shadowColor = "black";
          kohrCtx.shadowBlur = 2;
          baseCtx.shadowBlur = 2;
          for(index in entitiesToDraw){
            var entity = entitiesToDraw[index]
            if(entity.atMiddle === false || entity.atMiddle === true){
              var eMiddle = entity.atMiddle
            }else{
              var eMiddle = true
            }
            if(!eMiddle && entity.team != userTeam){
              continue //entity is at other base
            }
            if(entity.team == userTeam){
              var color = "blue"
            }else{
              var color = "red"
            }
            var entityX = entity.x - 1
            var entityY = entity.y - 1
            if(userTeam == 1){
              var entityX = -entityX + givenGame.gameInfo.maxPlayers + 4
              var entityY = -entityY + givenGame.gameInfo.maxPlayers + 4
            }
            if(entity.type == "Wall"){
              var neighbors = getWallNeighbors(entitiesToDraw,entity.x,entity.y,userTeam,entity.team)
              var globalX = (2*kohrM + kohrWidthCell) + (entityX*kohrWidthCell) + (entityY*kohrWidthCell)
              var globalY = (gridHeight/2) + (entityX*kohrHeightCell) - (entityY*kohrHeightCell)
              var h = kohrHeightCell/3
              var w = kohrWidthCell/3
              var wallHeight = 5*h
              var fillColor = "rgba(32,32,43,1)"
              if(userSelected.x == entity.x && userSelected.y == entity.y && userSelected.atMiddle && !userSelected.unselect){
                var fillColor = "rgba(60,80,80,1)"
              }
              if(color == "blue"){
                var border = ["rgba(100,165,255,1)",1]
              }else{
                var border = ["rgba(255,80,80,1)",1]
              }
              //DRAWING WALLS
              if(neighbors[0] && neighbors[1] && neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-2*w,-1*h],[-1*w,0*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[1*w,0*h],[2*w,-1*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[-1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[1*w,2*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && !neighbors[1] && !neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[0*w,1*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[1*w,0*h],[0*w,1*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && !neighbors[1] && !neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[1*w,2*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && !neighbors[1] && neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[1*w,0*h],[-1*w,2*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && !neighbors[1] && neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[-1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[1*w,2*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && neighbors[1] && !neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[0*w,1*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[2*w,-1*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && neighbors[1] && !neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[1*w,0*h],[2*w,-1*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && neighbors[1] && neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,2*h],[2*w,-1*h]],wallHeight,fillColor,border)
              }else if(!neighbors[0] && neighbors[1] && neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[-1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[1*w,0*h],[2*w,-1*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && !neighbors[1] && !neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-2*w,-1*h],[0*w,1*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[1*w,0*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && !neighbors[1] && !neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-2*w,-1*h],[1*w,2*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && !neighbors[1] && neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,2*h],[1*w,0*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[-2*w,-1*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && !neighbors[1] && neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[-1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[-2*w,-1*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && neighbors[1] && !neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[-2*w,-1*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[0*w,1*h],[2*w,-1*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && neighbors[1] && !neighbors[2] && neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-2*w,-1*h],[1*w,2*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[1*w,0*h],[2*w,-1*h]],wallHeight,fillColor,border)
              }else if(neighbors[0] && neighbors[1] && neighbors[2] && !neighbors[3]){
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,2*h],[2*w,-1*h]],wallHeight,fillColor,border)
                drawParaS(kohrCtx,globalX,globalY,[[-1*w,0*h],[-2*w,-1*h]],wallHeight,fillColor,border)
              }
            }else{
              entityImage = new Image()
              var entityImage = document.getElementById("cache-" + color + "_" + entity.type.toLowerCase())
              if(eMiddle){
                let imageSize = (kohrHeightCell/250) * imageScales[entity.type] * 500
                let x = (2*kohrM + kohrWidthCell) + (entityX*kohrWidthCell) + (entityY*kohrWidthCell)
                let y = (gridHeight/2) + (entityX*kohrHeightCell) - (entityY*kohrHeightCell)
                kohrCtx.drawImage(entityImage, x + imageOffsets[entity.type][0] - imageSize/2, y + imageOffsets[entity.type][1] - imageSize, imageSize, imageSize);
              }else{
                let imageSize = (baseHeightCell/250) * imageScales[entity.type] * 500
                let x = (2*baseM + baseWidthCell) + (entityX*baseWidthCell) + (entityY*baseWidthCell)
                let y = (gridHeight/2) + (entityX*baseHeightCell) - (entityY*baseHeightCell)
                baseCtx.drawImage(entityImage, x + imageOffsets[entity.type][0] - imageSize/2, y + imageOffsets[entity.type][1] - imageSize, imageSize, imageSize);
              }
            }
          }
          for(index in entitiesToDraw){
            var entity = entitiesToDraw[index]
            if(entity.team == userTeam){
              var color = "blue"
            }else{
              var color = "red"
            }
            var entityX = entity.x - 1
            var entityY = entity.y - 1
            if(userTeam == 1){
              var entityX = -entityX + givenGame.gameInfo.maxPlayers + 4
              var entityY = -entityY + givenGame.gameInfo.maxPlayers + 4
            }
            var neighbors = getWallNeighbors(entitiesToDraw,entity.x,entity.y,userTeam,entity.team)
            var globalX = (2*kohrM + kohrWidthCell) + (entityX*kohrWidthCell) + (entityY*kohrWidthCell)
            var globalY = (gridHeight/2) + (entityX*kohrHeightCell) - (entityY*kohrHeightCell)
            var h = kohrHeightCell/3
            var w = kohrWidthCell/3
            var wallHeight = 5*h
            var border = ["#000000",1]
            if(entity.type == "Wall"){
              //DRAWING TOP OF WALLS ON TOP OF EVERYTHING
              if(color == "blue"){
                var fillColor = "rgba(100,165,255,1)"
              }else{
                var fillColor = "rgba(255,80,80,1)"
              }
              var polyPoints = [[-1*w,0]]
              if(neighbors[0]){
                polyPoints.push([-2*w,-1*h],[-1*w,-2*h])
              }
              polyPoints.push([0*w,-1*h])
              if(neighbors[1]){
                polyPoints.push([1*w,-2*h],[2*w,-1*h])
              }
              polyPoints.push([1*w,0*h])
              if(neighbors[3]){
                polyPoints.push([2*w,1*h],[1*w,2*h])
              }
              polyPoints.push([0*w,1*h])
              if(neighbors[2]){
                polyPoints.push([-1*w,2*h],[-2*w,1*h])
              }
              drawPoly(kohrCtx,globalX,globalY,polyPoints,wallHeight,fillColor,[fillColor,border[1]])
            }
          }
          kohrCtx.shodowBlur = 0;
          baseCtx.shodowBlur = 0;

          //LEFT SHOW DEF
          if(!canPlay){
            var leftShow = 1;
          }else{
            var selectedPiece = givenGame.pieces.find(piece => piece.x == userSelected.x && piece.y == userSelected.y)
            var selectedBuilding = givenGame.buildings.find(building => building.x == userSelected.x && building.y == userSelected.y && building.atMiddle == userSelected.atMiddle)
            if(selectedPiece != undefined){
              if(selectedPiece.team == userTeam){
                if(selectedPiece.buildingTimeLeft == 0){
                  var leftShow = 5;
                }else{
                  var leftShow = 3;
                }
              }else{
                var leftShow = 2;
              }
            }else if(selectedBuilding != undefined){
              if(selectedBuilding.team == userTeam){
                var leftShow = 6;
              }else{
                var leftShow = 2;
              }
            }else{
              var leftShow = 4;
            }
          }

          //HIDING LEFT FRAMES
          for (let i = 1; i < 7; i++) {
            if(i == leftShow){
              $(".game-action-" + i).attr("hidden",false)
            }else{
              $(".game-action-" + i).attr("hidden",true)
            }
          }

          //SETTING LEFT FRAMES
          if(leftShow == 4){
            $('.game-action-4').children('button').each(function() {
              var showAsPossible = true;
              //SOLO AT MIDDLE
              if(userSelected.atMiddle){
                var neighbours = 0
                givenGame.buildings.forEach(function(building){
                  if(Math.abs(building.x - userSelected.x) + Math.abs(building.y - userSelected.y) == 1 && building.atMiddle == userSelected.atMiddle && building.team == userTeam){
                    neighbours = neighbours + 1
                  }
                })
                if(neighbours == 0){
                  showAsPossible = false;
                }
              }

              //INVALID WORLD
              var cuts = $(this).attr("id").split("-");
              var name = cuts[cuts.length - 1]
              if(["Queen","Rook","Bishop","Pawn","Knight","Enchanter"].indexOf(name) != -1 && !userSelected.atMiddle){
                showAsPossible = false;
              }
              if(name == "Wall" && !userSelected.atMiddle){
                showAsPossible = false;
              }
              if(name == "Battery" && userSelected.atMiddle){
                showAsPossible = false;
              }
              if(name == "Workshop" && userSelected.atMiddle){
                showAsPossible = false;
              }

              $(this).attr("disabled",!showAsPossible)
            })
          }else if(["Queen","Rook","Bishop","Pawn","Knight","Enchanter","Wall","Extractor","LightArmory","HeavyArmory","Workshop","Battery"].indexOf(userSelected.switch) != -1){
            userSelected.switch = ""
          }

          //SET DYNAMIC CSS PROPERTIES AT END
          $(".game-switch-" + userSelected.switch).css("background-color","green")
          return [givenGame,userSelected];
        }

        socket.on("disconnect",function(){
          $("#disconnected-frame").attr("hidden",false);
          $("#login-frame").attr("hidden",true);
        });

        socket.on("fatalError",function(data){
          alert("Fatal error : " + data.text)
          document.location.reload(true);
        })
        
        socket.on("logError",function(data){
          console.log("Warning : " + data.text)
        })

        socket.on("showError",function(data){
          alert(data.text)
        })

        socket.on("leaveSession",function(data){
          document.location.reload(true);
        })

        socket.on("setTempName",function(data){
          pseudo = data.tempName
          $("#disconnected-frame").attr("hidden",true);
          $("#login-frame").attr("hidden",false);
        });

        socket.on("showLobby",function(data){
          $("#lobby-title").text(data.gameInfo.name)
          $("#lobby-gamemode").text("Mode : " + data.gameInfo.maxPlayers/2 + "vs" + data.gameInfo.maxPlayers/2)
          $("#lobby-player-list-label").text("Joueurs " + data.players.length + "/" + data.gameInfo.maxPlayers)
          $("#lobby-player-list").empty()
          $("#lobby-action-list").empty()
          for(var player of data.players){
            if(player.pseudo == pseudo){
              $("#lobby-player-list").append("<li class='lobby-players'>" + player.pseudo + " (" + data.gameInfo.teamNames[player.team] + ")<input value='Quitter' type='button' class='lobby-player-kick-buttons' id='lobby-actions-" + player.pseudo + "'/><input value=\"Changer d'équipe\" type='button' class='lobby-player-team-buttons' id='lobby-actions-" + player.pseudo + "'/></li>")
            }else if(data.asMaster){
              $("#lobby-player-list").append("<li class='lobby-players'>" + player.pseudo + " (" + data.gameInfo.teamNames[player.team] + ")<input value='Kick' type='button' class='lobby-player-kick-buttons' id='lobby-actions-" + player.pseudo + "'/><input value=\"Changer d'équipe\" type='button' class='lobby-player-team-buttons' id='lobby-actions-" + player.pseudo + "'/></li>")
            }else{
              $("#lobby-player-list").append("<li class='lobby-players'>" + player.pseudo + " (" + data.gameInfo.teamNames[player.team] + ")</li>")
            }
          }
          if(data.asMaster){
            $("#lobby-action-list").append("<input type='button' class='lobby-actions' id='lobby-action-change-mode' value='Changer de mode'/>")
            $("#lobby-action-list").append("<br/>")
            $("#lobby-action-list").append("<br/>")
            $("#lobby-action-list").append("<input type='button' class='lobby-actions' id='lobby-action-start-game' value='Lancer !'/>")
            $("#lobby-action-list").append("<br/>")
            $("#lobby-action-list").append("<br/>")
          }
          $(".lobby-player-kick-buttons").click(function(){
            var actionOnPseudo = $(this).attr("id").slice(14)
            socket.emit("playerKick",{pseudoToKick : actionOnPseudo});
          })
          $(".lobby-player-team-buttons").click(function(){
            var actionOnPseudo = $(this).attr("id").slice(14)
            socket.emit("playerSwitchTeam",{pseudoToSwitch : actionOnPseudo});
          })
          $("#lobby-action-change-mode").click(function(){
            socket.emit("gameChangeMode");
          })
          $("#lobby-action-start-game").click(function(){
            socket.emit("gameStart");
          })
          $("#login-frame").attr("hidden",true);
          $("#lobby-frame").attr("hidden",false);
        });
        
        socket.on("showGamePlay",function(data){
          canPlay = true
          var returnedStuff = showGame(data,pseudo,selected,canPlay)
          game = returnedStuff[0]
          selected = returnedStuff[1]
        })
        
        socket.on("showGameWait",function(data){
          canPlay = false
          var returnedStuff = showGame(data,pseudo,selected,canPlay)
          game = returnedStuff[0]
          selected = returnedStuff[1]
        })
        
      });

    </script>
  </body>
</html>
